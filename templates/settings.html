{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
<style>
    .settings-section {
        margin-bottom: 35px;
        padding-bottom: 25px;
        border-bottom: 1px solid #f0f0f0;
    }

    .settings-section:last-child {
        border-bottom: none;
    }

    .settings-title {
        font-size: 1.2rem;
        font-weight: 700;
        margin-bottom: 15px;
        color: var(--primary-color);
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .setting-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
    }

    .setting-info h4 {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 4px;
    }

    .setting-info p {
        font-size: 0.85rem;
        color: #888;
    }

    .toggle-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
    }

    .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #eee;
        transition: .4s;
        border-radius: 24px;
    }

    .slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }

    input:checked+.slider {
        background-color: var(--primary-color);
    }

    input:checked+.slider:before {
        transform: translateX(26px);
    }

    .settings-select {
        padding: 8px 15px;
        border: 1.5px solid #eee;
        border-radius: 10px;
        font-size: 0.9rem;
        color: #555;
        background: #fff;
        outline: none;
        cursor: pointer;
        transition: var(--transition);
        font-family: 'Fredoka', sans-serif;
        font-weight: 600;
    }

    .settings-select:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(158, 23, 158, 0.1);
    }

    /* Dark Mode styles for Settings (specific overrides if needed) */
    body.dark-mode .settings-select {
        background: #2a2a2a;
        border-color: #444;
        color: #ddd;
    }
</style>
{% endblock %}

{% block content %}
<div class="profile-container">
    <div class="profile-header">
        <h1>Settings</h1>
        <p>Manage your account preferences and security</p>
    </div>

    <div class="profile-grid">
        <!-- Sidebar -->
        <div class="profile-sidebar">
            <div class="profile-avatar-wrapper">
                <div class="profile-avatar-huge" id="profilePageAvatar">?</div>
            </div>
            <h2 id="profilePageUsername">Username</h2>
            <p class="email" id="profilePageEmail">user@example.com</p>

            <ul class="sidebar-nav">
                <li><a href="{{ url_for('profile') }}"><i class="fas fa-user-circle"></i> Personal Info</a></li>
                <li><a href="{{ url_for('orders') }}"><i class="fas fa-shopping-bag"></i> My Orders</a></li>
                <li><a href="{{ url_for('settings') }}" class="active"><i class="fas fa-cog"></i> Settings</a></li>
                <li><a href="javascript:void(0)" onclick="handleLogout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="profile-main">
            <div class="settings-section">
                <h3 class="settings-title"><i class="fas fa-shield-alt"></i> Security</h3>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Password</h4>
                        <p>Change your account password regularly for better security.</p>
                    </div>
                    <button class="action-btn-secondary"
                        onclick="showToast('Password change coming soon!', 'info')">Change</button>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Two-Factor Authentication</h4>
                        <p>Add an extra layer of security to your account.</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="settings-section">
                <h3 class="settings-title"><i class="fas fa-palette"></i> Appearance</h3>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Dark Mode</h4>
                        <p>Switch between light and dark themes for the entire dashboard.</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="themeToggle" onchange="toggleTheme()">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="settings-section">
                <h3 class="settings-title"><i class="fas fa-globe"></i> Regional</h3>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Language</h4>
                        <p>Select your default language for the website.</p>
                    </div>
                    <select class="settings-select" id="languageSelect" onchange="updateLanguage()">
                        <option value="en">English</option>
                        <option value="si">Sinhala</option>
                        <option value="fr">French</option>
                        <option value="es">Spanish</option>
                    </select>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Currency</h4>
                        <p>Prices will be displayed in this currency.</p>
                    </div>
                    <select class="settings-select" id="currencySelect" onchange="updateCurrency()">
                        <option value="LKR">LKR (Rs.)</option>
                        <option value="USD">USD ($)</option>
                        <option value="EUR">EUR (€)</option>
                        <option value="GBP">GBP (£)</option>
                    </select>
                </div>
            </div>

            <div class="settings-section">
                <h3 class="settings-title"><i class="fas fa-bell"></i> Notifications</h3>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Email Notifications</h4>
                        <p>Receive updates about your orders and special offers.</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Promotional SMS</h4>
                        <p>Get instant alerts about flash sales and new collections.</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="settings-section">
                <h3 class="settings-title"><i class="fas fa-trash-alt"></i> Account Action</h3>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4 style="color: #ff4d4d;">Delete Account</h4>
                        <p>Permanently remove your account and all associated data.</p>
                    </div>
                    <button class="action-btn-secondary" style="color: #ff4d4d; border-color: #ff4d4d;"
                        onclick="confirm('Are you sure?')">Delete</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const currentUser = JSON.parse(localStorage.getItem('lomiees_current_user'));
        if (!currentUser) {
            window.location.href = '/';
            return;
        }
        const firstLetter = currentUser.username.charAt(0).toUpperCase();
        document.getElementById('profilePageAvatar').textContent = firstLetter;
        document.getElementById('profilePageUsername').textContent = currentUser.username;
        document.getElementById('profilePageEmail').textContent = currentUser.email;

        // Load preferences
        const theme = localStorage.getItem('lomiees_theme') || 'light';
        document.getElementById('themeToggle').checked = theme === 'dark';
        if (theme === 'dark') document.documentElement.classList.add('dark-mode');

        const lang = localStorage.getItem('lomiees_language') || 'en';
        document.getElementById('languageSelect').value = lang;

        const currency = localStorage.getItem('lomiees_currency') || 'LKR';
        document.getElementById('currencySelect').value = currency;
    });

    function toggleTheme() {
        const isDark = document.getElementById('themeToggle').checked;
        if (isDark) {
            document.documentElement.classList.add('dark-mode');
            localStorage.setItem('lomiees_theme', 'dark');
            showToast('Dark mode enabled', 'info');
        } else {
            document.documentElement.classList.remove('dark-mode');
            localStorage.setItem('lomiees_theme', 'light');
            showToast('Light mode enabled', 'info');
        }
    }

    function updateLanguage() {
        const lang = document.getElementById('languageSelect').value;
        localStorage.setItem('lomiees_language', lang);

        // Deep Google Translate Override via Cookie
        if (lang === 'en') {
            document.cookie = "googtrans=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
            document.cookie = "googtrans=; expires=Thu, 01 Jan 1970 00:00:00 UTC; domain=" + location.hostname + "; path=/;";
        } else {
            const googtransValue = "/en/" + lang;
            document.cookie = "googtrans=" + googtransValue + "; path=/";
            document.cookie = "googtrans=" + googtransValue + "; domain=" + location.hostname + "; path=/";
        }

        showToast('Applying Language...', 'info');
        setTimeout(() => {
            window.location.reload();
        }, 800);
    }

    function updateCurrency() {
        const currency = document.getElementById('currencySelect').value;
        localStorage.setItem('lomiees_currency', currency);
        showToast(`Currency changed to ${currency}`, 'success');
        setTimeout(() => {
            window.location.reload();
        }, 800);
    }
</script>
{% endblock %}